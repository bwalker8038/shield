<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>README.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>README.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-1">#</a> -->
        <!-- </div> -->
        <h1>Shield</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-2">#</a> -->
        <!-- </div> -->
        <p> A simple authentication framework for use with a basic Rack application.
 It doesn&rsquo;t try to be generic and instead has the following assertions:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-3">#</a> -->
        <!-- </div> -->
        <ol>
<li>You use <a href="http://ohm.keyvalue.org">Ohm</a> for your persistence layer.</li>
<li>That your app has some form of a Helper plugin system.</li>
</ol>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-4">#</a> -->
        <!-- </div> -->
        <h1>Usage</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-5">#</a> -->
        <!-- </div> -->
        <p> The fastest way to get started with <code>Shield</code> is to use it as a <a href="http://sinatrarb.com">Sinatra</a>
 extension on top of your main application.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-6">#</a> -->
        <!-- </div> -->
        <p> We simply have to require sinatra, shield, and <a href="http://ohm.keyvalue.org">Ohm</a>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s2">&quot;sinatra/base&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;shield&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;ohm&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-7">#</a> -->
        <!-- </div> -->
        <p> We then define a <code>User</code> class on the top-level namespace:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">Shield</span><span class="o">::</span><span class="no">User</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-8">#</a> -->
        <!-- </div> -->
        <p> Our sinatra application can be a classic style, but for this example,
 we&rsquo;ll use the more modular style extending from <code>Sinatra::Base</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-9">#</a> -->
        <!-- </div> -->
        <p> One very very important detail to remember is that you need to
 have session support for all of Shield to work.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">enable</span> <span class="ss">:sessions</span></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-10">#</a> -->
        <!-- </div> -->
        <p> Now for the main highlight: This line simply does two things:
 1. It adds <code>Shield::Helpers</code> to your Sinatra app&rsquo;s helpers.
 2. It adds <code>Shield::Login</code> as a middleware for your application.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">register</span> <span class="no">Shield</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-11">#</a> -->
        <!-- </div> -->
        <p> This is a normal sinatra route. No authentication is needed here.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">get</span> <span class="s2">&quot;/public&quot;</span> <span class="k">do</span>
    <span class="s2">&quot;Public&quot;</span>
  <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-12">#</a> -->
        <!-- </div> -->
        <p> This is a private sinatra route, which we enforce using
 <code>ensure_authenticated</code>. This method comes from <code>Shield::Helpers</code> along
 with some other helper methods:</p>

<ol>
<li><code>current_user</code>         &ndash; ain&rsquo;t this the standard nowadays?</li>
<li><code>logged_in?</code>           &ndash; simple sugar to verify if the user is logged in.</li>
<li><code>ensure_authenticated</code> &ndash; as shown here.</li>
<li><code>redirect_to_stored</code>   &ndash; redirects to the previous url the user was

<pre><code>                     trying to access prior to authenticating.
</code></pre></li>
</ol>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">get</span> <span class="s2">&quot;/private&quot;</span> <span class="k">do</span>
    <span class="n">ensure_authenticated</span>

    <span class="s2">&quot;Private&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-13">#</a> -->
        <!-- </div> -->
        <p> If this file was run directly i.e. ruby README.rb.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">if</span> <span class="bp">__FILE__</span> <span class="o">==</span> <span class="vg">$0</span></pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-14">#</a> -->
        <!-- </div> -->
        <p> For the purposes of this quick script, let&rsquo;s create a User. You&rsquo;ll use that
 to quickly verify that you can indeed login to the application.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">if</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">&quot;quentin@test.com&quot;</span><span class="p">,</span>
                <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span>
                <span class="ss">:password_confirmation</span> <span class="o">=&gt;</span> <span class="s2">&quot;password&quot;</span><span class="p">)</span>
  <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <!-- <div class="octowrap"> -->
        <!--   <a class="octothorpe" href="#section-15">#</a> -->
        <!-- </div> -->
        <p> Let Sinatra take the stage.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="no">App</span><span class="o">.</span><span class="n">run!</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    </table>
</div>
</body>